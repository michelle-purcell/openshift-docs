:_mod-docs-content-type: ASSEMBLY
[id="using-insights-operator"]
= Using the Insights Operator
include::_attributes/common-attributes.adoc[]
ifdef::openshift-dedicated[]
include::_attributes/attributes-openshift-dedicated.adoc[]
endif::[]
:context: using-insights-operator

toc::[]

The Insights Operator periodically gathers configuration and component failure status and, by default, reports that data every two hours to Red Hat. This information enables Red Hat to assess configuration and deeper failure data than is reported through Telemetry. Users of {product-title} can display the report in the {insights-advisor-url} service on {hybrid-console}.

[role="_additional-resources"]
.Additional resources

ifndef::openshift-rosa,openshift-rosa-hcp,openshift-dedicated[]
* The Insights Operator is installed and enabled by default. If you need to opt out of remote health reporting, see xref:../../support/remote_health_monitoring/remote-health-reporting.adoc#remote-health-reporting[Remote health reporting].
endif::openshift-rosa,openshift-rosa-hcp,openshift-dedicated[]

* For more information on using the Insights advisor service to identify issues with your cluster, see xref:../../support/remote_health_monitoring/using-insights-to-identify-issues-with-your-cluster.adoc#using-insights-to-identify-issues-with-your-cluster[Using Insights to identify issues with your cluster].

ifndef::openshift-rosa,openshift-rosa-hcp,openshift-dedicated[]
include::modules/insights-operator-configuring.adoc[leveloffset=+1]
endif::openshift-rosa,openshift-rosa-hcp,openshift-dedicated[]

include::modules/understanding-insights-operator-alerts.adoc[leveloffset=+1]
ifndef::openshift-rosa,openshift-rosa-hcp,openshift-dedicated[]
include::modules/disabling-insights-operator-alerts.adoc[leveloffset=+2]
include::modules/enabling-insights-operator-alerts.adoc[leveloffset=+2]
endif::openshift-rosa,openshift-rosa-hcp,openshift-dedicated[]
// cannot create resource "pods/exec" in API group "" in the namespace "openshift-insights"

ifndef::openshift-rosa,openshift-rosa-hcp,openshift-dedicated[]
include::modules/insights-operator-downloading-archive.adoc[leveloffset=+1]
// cannot download archive using previous module
endif::openshift-rosa,openshift-rosa-hcp,openshift-dedicated[]

// InsightsDataGather is a Tech Preview feature. When the feature goes GA, verify if it can be added to ROSA/OSD.

// tech preview feature
ifndef::openshift-rosa,openshift-rosa-hcp,openshift-dedicated[]
[id="running-insights-operator-gather_using-insights-operator"]
== Running an Insights Operator gather operation on-demand

Instead of waiting for the next periodic data gather operation, you can run a custom on-demand Insights Operator data gather operation by using the {product-title} web console or command-line interface (CLI). 

A periodic data gather operation uses the `InsightsDataGather` custom resource definition (CRD) for configuration instructions, whereas an on-demand equivalent requires a `DataGather` CRD to be configured.

An on-demand `DataGather` operation is:

* Useful for one-off data collections that require different CRD configurations to the periodic data gathering (`InsightsDataGather`) specification.
* Independent from the periodic data gathering. When you create an on-demand `DataGather` CRD, the configuration is independent from your periodic data gathering job's  `InsightsDataGather` CRD specification.

**Custom specification options**

You can optionally customize the following items for the on-demand data gather operation:

* *Enable and define data obfuscation:* By defining the `DataGather` `dataPolicy` specification, you can enable additional obfuscation of the Insights archive data, for example, the IP address or workload names.

* *Enable persistant storage:* By default, the Insights Operator uses ephemeral storage, which means that a new pod will be created for each gather operation and the history of gather operations and data collected is not retained. You can switch to persistent storage to retain the data and history for up to the last 10 gather operations by defining the `DataGather` `storage` specification in the CRD.

* *Exclude specific data gather operations:*  You can choose to disable specific gather operations from running by defining the `DataGather` `gatherers` specification. For example, you can choose to disable the cluster authentication operation or the workload data operation.

[IMPORTANT]
====
Excluding gather operations from the default list might reduce or limit the  recommendations offered by the Insights Advisor for your cluster. 
====


If you do not configure any custom specification options in the `DataGather` CRD, the default Insights Operator data collection job will run. This means that all gather operations will run, the collected data will be unobfuscated and the archive file will not be retained.

When you run a gather operation on-demand, any configuration that was previously applied to disable Insights Operator gather operations for your cluster will be overridden.


:FeatureName: The `DataGather` custom resource
include::snippets/technology-preview.adoc[]

[NOTE]
====
If you enable Technology Preview in your cluster, the Insights Operator runs gather operations in individual pods. This is part of the Technology Preview feature set for the Insights Operator and supports the new data gathering features.
====
include::modules/insights-operator-gather-duration.adoc[leveloffset=+2]
include::modules/running-insights-operator-gather-web-console.adoc[leveloffset=+2]
include::modules/running-insights-operator-gather-cli.adoc[leveloffset=+2]

[role="_additional-resources"]
[id="additional-resources"]
.Additional resources
* link:https://github.com/openshift/insights-operator/blob/master/docs/gathered-data.md[Insights Operator Gathered Data GitHub repository]

endif::openshift-rosa,openshift-rosa-hcp,openshift-dedicated[]
// cannot list resource "secrets" in API group "" in the namespace "openshift-config"
ifndef::openshift-rosa,openshift-rosa-hcp,openshift-dedicated[]
include::modules/disabling-insights-operator-gather.adoc[leveloffset=+2]
include::modules/enabling-insights-operator-gather.adoc[leveloffset=+2]
endif::openshift-rosa,openshift-rosa-hcp,openshift-dedicated[]

include::modules/obfuscating-dvo-data.adoc[leveloffset=+1]
